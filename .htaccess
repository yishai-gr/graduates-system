RewriteEngine On

# 1. Allow the specific backend entry point to pass through (prevents infinite loop or 403 on valid rewrites)
RewriteCond %{REQUEST_URI} ^/backend/public/index\.php$
RewriteRule ^ - [L]

# 2. Block any request that does NOT start with /api
# This protects source code/git files/etc from direct access.
RewriteCond %{REQUEST_URI} !^/api
RewriteRule ^ - [F]

# 3. Route /api requests to the backend
RewriteRule ^api(/.*)?$ backend/public/index.php [L,QSA]
