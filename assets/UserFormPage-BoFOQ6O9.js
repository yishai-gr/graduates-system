import{a as g,j as e,v as p,_ as L,w}from"./ui-J8zN8ojh.js";import{d as S,u as y,a as C}from"./vendor-DK4z8uX1.js";import{a as I,B as m}from"./index-DNpSr7TS.js";import{u as F}from"./useDocumentTitle-mo0ffS8w.js";import{u as n}from"./usersService-B0l8xTxg.js";import{I as d}from"./input-p9w5ixzj.js";import{L as l}from"./label-BwTpjIUa.js";import{S as _,a as E,b as U,c as q,d as j}from"./select-BcMs1_f7.js";import{H as z}from"./HebrewYearCombobox-CGp5HyK7.js";import"./calendar-A3vjW2LN.js";function J(){const{id:r}=S(),o=y(),{isSuperAdmin:N}=I();F(r?"עריכת משתמש":"הוספת משתמש");const[s,v]=g.useState({formData:{firstName:"",lastName:"",email:"",role:"shiur_manager",shiurs:[]},isLoading:!1,initialLoading:!!r,error:""}),i=a=>{v(t=>({...t,...a}))};g.useEffect(()=>{r?(i({initialLoading:!0}),n.getUserById(r).then(a=>{i({formData:{firstName:a.firstName,lastName:a.lastName,email:a.email,role:a.role,shiurs:a.shiurs||[]},initialLoading:!1})}).catch(a=>{console.error(a),i({error:"לא ניתן לטעון את פרטי המשתמש",initialLoading:!1})})):i({initialLoading:!1})},[r]);const D=async a=>{a.preventDefault(),i({error:"",isLoading:!0});try{const{firstName:t,lastName:c,email:u,role:f,shiurs:b}=s.formData;if(!t||!c||!u)throw new Error("נא למלא את כל השדות החובה");const h={firstName:t,lastName:c,email:u,role:f,shiurs:f==="shiur_manager"?b:void 0};let x=r;r?await n.updateUser(r,h):x=(await n.createUser(h)).id,o(r?"/users":`/users/${x}/password`)}catch(t){i({error:t.message||"אירעה שגיאה בשמירת הנתונים",isLoading:!1})}finally{r&&i({isLoading:!1})}};return s.initialLoading?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(p,{className:"h-8 w-8 animate-spin text-primary"})}):N?e.jsxs("div",{className:"max-w-xl mx-auto py-8 px-4",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx(m,{variant:"ghost",size:"icon",onClick:()=>o("/users"),children:e.jsx(L,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-2xl font-bold",children:r?"עריכת פרטי משתמש":"הוספת משתמש חדש"})]}),e.jsx("div",{className:"bg-card border rounded-lg p-6 shadow-sm",children:e.jsxs("form",{onSubmit:D,className:"grid gap-6",children:[s.error&&e.jsxs("div",{className:"flex items-center gap-2 rounded-md bg-destructive/15 p-3 text-sm text-destructive",children:[e.jsx(w,{size:18}),e.jsx("span",{children:s.error})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(l,{htmlFor:"firstName",children:"שם פרטי"}),e.jsx(d,{id:"firstName",value:s.formData.firstName,onChange:a=>i({formData:{...s.formData,firstName:a.target.value}}),required:!0})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(l,{htmlFor:"lastName",children:"שם משפחה"}),e.jsx(d,{id:"lastName",value:s.formData.lastName,onChange:a=>i({formData:{...s.formData,lastName:a.target.value}}),required:!0})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(l,{htmlFor:"email",children:"אימייל"}),e.jsx(d,{id:"email",type:"email",value:s.formData.email,onChange:a=>i({formData:{...s.formData,email:a.target.value}}),required:!0})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(l,{htmlFor:"role",children:"תפקיד"}),e.jsxs(_,{value:s.formData.role,onValueChange:a=>i({formData:{...s.formData,role:a}}),children:[e.jsx(E,{id:"role",className:"w-full",children:e.jsx(U,{placeholder:"בחר תפקיד"})}),e.jsxs(q,{children:[e.jsx(j,{value:"shiur_manager",children:"אחראי שיעור"}),e.jsx(j,{value:"super_admin",children:"מנהל ראשי"})]})]})]}),s.formData.role==="shiur_manager"&&e.jsxs("div",{className:"grid gap-2 animate-in fade-in duration-300",children:[e.jsx(l,{htmlFor:"shiurs",children:"מחזורים (שנים עבריות)"}),e.jsx(z,{value:s.formData.shiurs,onChange:a=>i({formData:{...s.formData,shiurs:a}}),multiple:!0}),e.jsx("p",{className:"text-[0.8rem] text-muted-foreground",children:"ניתן לבחור מספר מחזורים."})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx(m,{type:"button",variant:"outline",onClick:()=>o("/users"),disabled:s.isLoading,children:"ביטול"}),e.jsxs(m,{type:"submit",disabled:s.isLoading,children:[s.isLoading&&e.jsx(p,{className:"ml-2 h-4 w-4 animate-spin"}),r?"שמור שינויים":"צור משתמש"]})]})]})})]}):e.jsx(C,{to:"/unauthorized"})}export{J as default};
