import{j as e,l as A,a as n,y,z as D,A as K,B as S,C as P,E as V,F,m as E}from"./ui-J8zN8ojh.js";import{B as g,T as u,b as m,d as h,D as $,e as O,f as B,g as N,a as Q,h as H}from"./index-DNpSr7TS.js";import{u as L}from"./useDocumentTitle-mo0ffS8w.js";import{u as M}from"./usersService-B0l8xTxg.js";import{u as R,D as G,a as J,M as W,b as X,C as Y}from"./MobileCardsView-BFWiBFth.js";import{u as Z,a as ee}from"./vendor-DK4z8uX1.js";import{C as se,a as ae}from"./card-kEnWUetb.js";import"./input-p9w5ixzj.js";import"./popover-9AYq1YrO.js";import"./select-BcMs1_f7.js";function te({onAdd:i}){return e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold tracking-tight",children:"ניהול משתמשים"}),e.jsxs(g,{onClick:i,className:"w-full sm:w-auto",children:[e.jsx(A,{className:"mr-2 h-4 w-4"}),"הוספת משתמש"]})]})}function re(i){return R({queryKey:["users",i],queryFn:()=>M.getUsers(i),placeholderData:d=>d})}const le=n.memo(function({user:s,onEdit:d,onView:c,onDelete:t,canEdit:a,canDelete:o,onChangePassword:f}){const x=n.useRef(0),p=()=>{const l=Date.now();l-x.current<300&&c(s),x.current=l},b=(l,j)=>{j.offset.x<-100&&a&&d(s),j.offset.x>100&&o&&t&&t(s)};return e.jsxs("div",{className:"relative",children:[a&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-start rounded-lg bg-orange-100 pl-4 z-0 left-1/2 dark:bg-yellow-950",children:e.jsxs("div",{className:"flex flex-col items-center gap-1 text-orange-600 font-bold px-2 text-sm dark:text-yellow-400",children:[e.jsx(y,{size:16}),e.jsx("span",{children:"עריכה"})]})}),o&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-end rounded-lg bg-red-100 pr-4 z-0 right-1/2 dark:bg-red-950",children:e.jsxs("div",{className:"flex flex-col items-center gap-1 text-red-600 font-bold px-2 text-sm dark:text-red-400",children:[e.jsx(D,{size:16}),e.jsx("span",{children:"מחיקה"})]})}),e.jsx(K.div,{drag:"x",dragConstraints:{left:0,right:0},dragElastic:{left:a?.2:0,right:o?.2:0},onDragEnd:b,onTap:p,className:"touch-pan-y relative z-10 bg-card rounded-lg",style:{x:0},children:e.jsx(se,{className:"p-0 border-0 shadow-none",children:e.jsx(ae,{className:"p-4 py-3",children:e.jsxs("div",{className:"flex justify-between items-center gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"font-bold text-lg flex items-center gap-2 truncate",children:[e.jsxs("span",{className:"truncate",children:[s.firstName," ",s.lastName]}),!s.passwordChanged&&e.jsxs(u,{children:[e.jsx(m,{asChild:!0,children:e.jsx("div",{className:"h-2 w-2 rounded-full bg-red-500 animate-pulse shrink-0"})}),e.jsx(h,{children:e.jsx("p",{children:"למשתמש זה לא הוגדרה סיסמה"})})]})]}),e.jsx("div",{className:"text-sm text-muted-foreground mt-1 flex items-center gap-1",children:s.role==="shiur_manager"&&e.jsxs("div",{className:"text-sm truncate",children:[e.jsx("span",{className:"font-semibold",children:"מחזורים: "}),Array.isArray(s.shiurs)&&s.shiurs.length>0?s.shiurs.join(", "):"-"]})})]}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsx("span",{className:`inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium gap-1 whitespace-nowrap ${s.role==="super_admin"?"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-300":"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300"}`,children:s.role==="super_admin"?e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"h-3 w-3"})," מנהל"]}):e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"h-3 w-3"})," אחראי"]})}),e.jsx("div",{role:"none",onPointerDown:l=>l.stopPropagation(),onClick:l=>l.stopPropagation(),onKeyDown:l=>l.stopPropagation(),children:e.jsxs($,{children:[e.jsx(O,{asChild:!0,children:e.jsx(g,{variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(V,{className:"h-4 w-4"})})}),e.jsxs(B,{align:"end",className:"w-auto flex flex-row gap-2 p-2",children:[e.jsxs(N,{onClick:()=>c(s),className:"flex flex-col items-center justify-center gap-1 rounded-md bg-secondary/10 p-2 aspect-square focus:bg-secondary/20",children:[e.jsx(F,{className:"h-6 w-6 text-primary"}),e.jsx("span",{className:"text-xs font-medium",children:"צפייה"})]}),f&&e.jsxs(N,{onClick:()=>f(s),className:"relative flex flex-col items-center justify-center gap-1 rounded-md bg-blue-50 dark:bg-blue-900/20 p-2  aspect-square focus:bg-blue-100 dark:focus:bg-blue-900/40",children:[!s.passwordChanged&&e.jsx("span",{className:"absolute top-1 right-1 h-2 w-2 rounded-full bg-red-500 animate-pulse"}),e.jsx(E,{className:"h-6 w-6 text-blue-600 dark:text-blue-400"}),e.jsx("span",{className:"text-xs font-medium text-blue-700 dark:text-blue-300",children:"סיסמה"})]}),a&&e.jsxs(N,{onClick:()=>d(s),className:"flex flex-col items-center justify-center gap-1 rounded-md bg-orange-50 dark:bg-orange-900/20 p-2  aspect-square focus:bg-orange-100 dark:focus:bg-orange-900/40",children:[e.jsx(y,{className:"h-6 w-6 text-orange-600 dark:text-orange-400"}),e.jsx("span",{className:"text-xs font-medium text-orange-700 dark:text-orange-300",children:"עריכה"})]}),o&&t&&e.jsxs(N,{className:"flex flex-col items-center justify-center gap-1 rounded-md bg-red-50 dark:bg-red-900/20 p-2 aspect-square focus:bg-red-100 dark:focus:bg-red-900/40 text-destructive focus:text-destructive dark:text-red-400 dark:focus:text-red-300",onClick:()=>t(s),children:[e.jsx(D,{className:"h-6 w-6"}),e.jsx("span",{className:"text-xs font-medium",children:"מחיקה"})]})]})]})})]})]})})})})]})});function ne({onView:i,onEdit:s,onDelete:d,onChangePassword:c}){return[{accessorKey:"fullName",header:"שם מלא",accessorFn:t=>`${t.firstName} ${t.lastName}`,cell:({row:t})=>{const a=t.original;return e.jsxs("div",{className:"font-medium flex items-center gap-2",children:[a.firstName," ",a.lastName,!a.passwordChanged&&e.jsxs(u,{children:[e.jsx(m,{asChild:!0,children:e.jsx("div",{className:"h-2 w-2 rounded-full bg-red-500 animate-pulse"})}),e.jsx(h,{children:e.jsx("p",{children:"למשתמש זה לא הוגדרה סיסמה"})})]})]})},meta:{filterVariant:"text"}},{accessorKey:"email",header:"אימייל",meta:{filterVariant:"text"}},{accessorKey:"role",header:"תפקיד",cell:({row:t})=>{const a=t.original;return e.jsx("span",{className:`inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium ${a.role==="super_admin"?"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-300":"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300"}`,children:a.role==="super_admin"?e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"ml-1 h-3 w-3"})," מנהל ראשי"]}):e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"ml-1 h-3 w-3"})," אחראי שיעור"]})})},meta:{filterVariant:"select",filterOptions:[{label:"מנהל ראשי",value:"super_admin"},{label:"אחראי שיעור",value:"shiur_manager"}]}},{accessorKey:"shiurs",header:"מחזורים",cell:({row:t})=>{const a=t.original;return a.role==="shiur_manager"&&Array.isArray(a.shiurs)&&a.shiurs.length>0?a.shiurs.join(", "):"-"},meta:{filterVariant:"presence"}},{id:"actions",header:"פעולות",cell:({row:t})=>{const a=t.original;return e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsxs(u,{children:[e.jsx(m,{asChild:!0,children:e.jsx(g,{variant:"ghost",size:"icon",onClick:()=>i(a),children:e.jsx(F,{className:"h-4 w-4"})})}),e.jsx(h,{children:e.jsx("p",{children:"צפייה"})})]}),e.jsxs(u,{children:[e.jsx(m,{asChild:!0,children:e.jsx(g,{variant:"ghost",size:"icon",onClick:()=>c(a),className:a.passwordChanged?"text-destructive hover:text-destructive":"text-accent hover:text-accent",children:e.jsx(E,{className:"h-4 w-4"})})}),e.jsx(h,{children:e.jsxs("p",{children:[a.passwordChanged?"שינוי":"הגדרת"," סיסמה"]})})]}),e.jsxs(u,{children:[e.jsx(m,{asChild:!0,children:e.jsx(g,{variant:"ghost",size:"icon",onClick:()=>s(a),children:e.jsx(y,{className:"h-4 w-4"})})}),e.jsx(h,{children:e.jsx("p",{children:"עריכה"})})]}),e.jsxs(u,{children:[e.jsx(m,{asChild:!0,children:e.jsx(g,{variant:"ghost",size:"icon",className:"text-destructive hover:text-destructive",onClick:()=>d(a),children:e.jsx(D,{className:"h-4 w-4"})})}),e.jsx(h,{children:e.jsx("p",{children:"מחיקה"})})]})]})}}]}function je(){const{isSuperAdmin:i}=Q(),s=Z();L("ניהול משתמשים");const d=H(),[c,t]=n.useState({pageIndex:0,pageSize:10,sorting:[],globalFilter:"",filters:[]}),[a,o]=n.useState(null),[f,x]=n.useState(!1),{data:p,isLoading:b,isFetching:l,isError:j}=re(c),T=p?.data??[],U=p?.total??0,z=p?.pages??1,C=n.useCallback(r=>{s(`/users/${r.id}/edit`)},[s]),_=n.useCallback(()=>{s("/users/new")},[s]),w=n.useCallback(r=>{s(`/users/${r.id}`)},[s]),v=n.useCallback(r=>{s(`/users/${r.id}/password`)},[s]),k=n.useCallback(r=>{o(r),x(!0)},[]),q=n.useCallback(async()=>{a&&(await M.deleteUser(a.id),x(!1),o(null),d.invalidateQueries({queryKey:["users"]}))},[a,d]),I=n.useMemo(()=>ne({onView:w,onEdit:C,onDelete:k,onChangePassword:v}),[w,C,k,v]);return i?e.jsxs("div",{className:"space-y-6",children:[e.jsx(te,{onAdd:_}),e.jsxs("div",{className:"bg-card rounded-lg border shadow-sm p-4 text-card-foreground flex flex-col",children:[e.jsx(G,{columns:I,state:c,onStateChange:t}),e.jsxs("div",{className:"overflow-x-auto rounded-md border",children:[e.jsx(J,{columns:I,data:T,pageCount:z,isLoading:b,isFetching:l,isError:j,state:c,onStateChange:t}),e.jsx(W,{data:T,isLoading:b,isFetching:l,isError:j,renderCard:r=>e.jsx(le,{user:r,onEdit:C,onView:w,onDelete:k,onChangePassword:v,canEdit:!0,canDelete:!0},r.id)})]}),e.jsx("div",{className:"mt-4 border-t pt-2",children:e.jsx(X,{state:c,onStateChange:t,totalItems:U,pageCount:z})})]}),e.jsx(Y,{open:f,onOpenChange:r=>{x(r),r||o(null)},title:"מחיקת משתמש",description:e.jsxs(e.Fragment,{children:["האם אתה בטוח שברצונך למחוק את המשתמש"," ",e.jsxs("strong",{children:[a?.firstName," ",a?.lastName]}),"? פעולה זו אינה הפיכה."]}),onConfirm:q,variant:"destructive",confirmText:"מחק"})]}):e.jsx(ee,{to:"/unauthorized"})}export{je as default};
