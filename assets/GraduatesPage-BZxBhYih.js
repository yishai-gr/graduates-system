import{a as c,j as e,o as A,G as H,H as ue,J as W,K as he,l as pe,M as ge,y as z,z as $,A as fe,h as je,N as ye,E as Ne,F as Y}from"./ui-J8zN8ojh.js";import{R as be,P as ve,C as J,c as y,i as we,j as Z,O as ee,k as se,A as Ce,B as m,D as ke,e as Re,f as Ee,g as D,T as F,b as O,d as P,a as Se,h as Te}from"./index-DNpSr7TS.js";import{u as Ie}from"./useDocumentTitle-mo0ffS8w.js";import{g as b}from"./graduatesService-B-eS1lEg.js";import{u as C,D as _e,a as De,M as Fe,b as Oe,C as Pe}from"./MobileCardsView-BFWiBFth.js";import{T as ze,a as $e,b as k,c as R}from"./tabs-DqgDeQiy.js";import{u as Ae,a as Me}from"./vendor-DK4z8uX1.js";import{C as Ge}from"./card-kEnWUetb.js";import{P as ae}from"./ProfileCompletion-Dx7uhK2Z.js";import"./input-p9w5ixzj.js";import"./popover-9AYq1YrO.js";import"./select-BcMs1_f7.js";const Le=be,Ve=ve,te=c.forwardRef(({className:s,...a},n)=>e.jsx(ee,{ref:n,className:y("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...a}));te.displayName=ee.displayName;const le=c.forwardRef(({className:s,children:a,...n},d)=>e.jsxs(Ve,{children:[e.jsx(te,{}),e.jsxs(J,{ref:d,className:y("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-4 sm:p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...n,children:[a,e.jsxs(we,{className:"absolute left-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx(A,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));le.displayName=J.displayName;const re=({className:s,...a})=>e.jsx("div",{className:y("flex flex-col space-y-1.5 text-center sm:text-right",s),...a});re.displayName="DialogHeader";const ne=({className:s,...a})=>e.jsx("div",{className:y("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...a});ne.displayName="DialogFooter";const ie=c.forwardRef(({className:s,...a},n)=>e.jsx(Z,{ref:n,className:y("text-lg font-semibold leading-none tracking-tight",s),...a}));ie.displayName=Z.displayName;const qe=c.forwardRef(({className:s,...a},n)=>e.jsx(se,{ref:n,className:y("text-sm text-muted-foreground",s),...a}));qe.displayName=se.displayName;class Ke{async previewImport(a){const n=new FormData;n.append("file",a);const d=localStorage.getItem("auth_token"),t={};d&&(t.Authorization=`Bearer ${d}`);const i=await fetch("/api/v1/graduates/import/preview",{method:"POST",body:n,headers:t});if(!i.ok){const r=await i.json();throw new Error(r?.error||"Failed to preview import")}return i.json()}async confirmImport(a){return Ce.post("/graduates/import/confirm",a)}}const Q=new Ke;function Ue({onFileSelect:s,selectedFile:a}){const n=d=>{const t=document.createElement("a");t.href=`/api/v1/graduates/import/sample/${d}`,t.download=`graduates-sample.${d}`,document.body.appendChild(t),t.click(),document.body.removeChild(t)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold",children:"הורדת קובץ לדוגמה"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>n("csv"),className:"gap-2",children:[e.jsx(H,{className:"h-4 w-4"}),"הורדת דוגמה CSV"]}),e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>n("xlsx"),className:"gap-2",children:[e.jsx(H,{className:"h-4 w-4"}),"הורדת דוגמה Excel"]})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"הורד קובץ דוגמה כדי לראות את הפורמט הנכון לייבוא"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold",children:"העלאת קובץ"}),e.jsxs("div",{className:"border-2 border-dashed rounded-lg p-8 text-center",children:[e.jsx("input",{type:"file",accept:".csv,.xlsx,.xls",onChange:s,className:"hidden",id:"file-input"}),e.jsxs("label",{htmlFor:"file-input",className:"cursor-pointer",children:[e.jsx(ue,{className:"h-8 w-8 mx-auto mb-2 text-muted-foreground"}),e.jsx("p",{className:"font-medium",children:a?a.name:"בחר קובץ או גרור הנה"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"CSV או Excel (עד 50MB)"})]})]})]}),e.jsxs("div",{className:"space-y-2 text-sm text-muted-foreground",children:[e.jsx("h4",{className:"font-semibold text-foreground",children:"הערות חשובות:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsx("li",{children:"השורה הראשונה צריכה להיות כותרות העמודות"}),e.jsx("li",{children:"ניתן להעלות בפורמטים CSV ו-Excel"}),e.jsx("li",{children:"גודל הקובץ המקסימלי הוא 50MB"}),e.jsx("li",{children:"כל השדות בתעודת זהות מעובדים לאימות Luhn"}),e.jsx("li",{children:'כתובות דוא"ל וטלפונים מאומתים'}),e.jsx("li",{children:"זיהוי אוטומטי של כפילויות"})]})]})]})}function Xe({previewData:s,rowsToImport:a,setRowsToImport:n}){const d=t=>{n(a.some(l=>l.row===t.row)?a.filter(l=>l.row!==t.row):[...a,t])};return e.jsxs(ze,{defaultValue:"valid",className:"space-y-4",children:[e.jsxs($e,{className:"grid w-full grid-cols-4",children:[e.jsxs(k,{value:"valid",children:["טוב (",s.summary.validRows,")"]}),e.jsxs(k,{value:"errors",children:["שגיאות (",s.summary.errorRows,")"]}),e.jsxs(k,{value:"duplicates",children:["כפולות (",s.summary.duplicateRows,")"]}),e.jsx(k,{value:"summary",children:"סיכום"})]}),e.jsxs(R,{value:"valid",className:"space-y-4",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.summary.validRows," שורות תקינות מוכנות לייבוא"]}),e.jsx("div",{className:"max-h-96 overflow-y-auto border rounded-lg",children:s.validRows.length>0?e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"border-b bg-muted sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 text-right",children:e.jsx("input",{type:"checkbox",checked:a.length===s.validRows.length,onChange:t=>{t.target.checked?n(s.validRows):n([])}})}),e.jsx("th",{className:"p-2 text-right",children:"שם"}),e.jsx("th",{className:"p-2 text-right",children:'דוא"ל'}),e.jsx("th",{className:"p-2 text-right",children:"שיעור"})]})}),e.jsx("tbody",{children:s.validRows.map(t=>e.jsxs("tr",{className:"border-b hover:bg-muted/50",children:[e.jsx("td",{className:"p-2",children:e.jsx("input",{type:"checkbox",checked:a.some(l=>l.row===t.row),onChange:()=>d(t)})}),e.jsxs("td",{className:"p-2",children:[t.data.first_name," ",t.data.last_name]}),e.jsx("td",{className:"p-2",children:t.data.email||"-"}),e.jsx("td",{className:"p-2",children:t.data.shiur_year||"-"})]},t.row))})]}):e.jsx("p",{className:"p-4 text-center text-muted-foreground",children:"אין שורות תקינות"})})]}),e.jsx(R,{value:"errors",className:"space-y-4",children:s.errorRows.length>0?e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:s.errorRows.map(t=>e.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(A,{className:"h-5 w-5 text-red-600 shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-red-900",children:["שורה ",t.row]}),e.jsx("ul",{className:"list-disc list-inside text-sm mt-1 text-red-800",children:t.errors.map((l,i)=>e.jsx("li",{children:l},i))})]})]})},t.row))}):e.jsx("p",{className:"text-center text-muted-foreground",children:"אין שגיאות"})}),e.jsx(R,{value:"duplicates",className:"space-y-4",children:s.duplicateRows.length>0?e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:s.duplicateRows.map(t=>e.jsx("div",{className:"p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(W,{className:"h-5 w-5 text-yellow-600 shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-yellow-900",children:["שורה ",t.row]}),e.jsxs("p",{className:"text-sm text-yellow-800",children:["כפול עבור: ",t.matchFields.join(", ")]}),e.jsxs("p",{className:"text-sm text-yellow-700",children:["בוגר קיים עם ID: ",t.duplicateId]})]})]})},t.row))}):e.jsx("p",{className:"text-center text-muted-foreground",children:"אין כפילויות"})}),e.jsx(R,{value:"summary",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"סך הכל שורות"}),e.jsx("p",{className:"text-2xl font-bold",children:s.summary.totalRows})]}),e.jsxs("div",{className:"p-4 border rounded-lg bg-green-50",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"שורות תקינות"}),e.jsx("p",{className:"text-2xl font-bold text-green-700",children:s.summary.validRows})]}),e.jsxs("div",{className:"p-4 border rounded-lg bg-red-50",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"שורות עם שגיאות"}),e.jsx("p",{className:"text-2xl font-bold text-red-700",children:s.summary.errorRows})]}),e.jsxs("div",{className:"p-4 border rounded-lg bg-yellow-50",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"שורות כפולות"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-700",children:s.summary.duplicateRows})]})]})})]})}function Be({importResults:s}){return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[s.imported>0&&e.jsxs("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg flex gap-4",children:[e.jsx(he,{className:"h-5 w-5 text-green-700 shrink-0 mt-0.5"}),e.jsx("div",{children:e.jsxs("p",{className:"font-semibold text-green-900",children:["בוגרים ",s.imported," יובאו בהצלחה"]})})]}),s.failed>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg flex gap-4",children:[e.jsx(A,{className:"h-5 w-5 text-red-700 shrink-0 mt-0.5"}),e.jsx("div",{children:e.jsxs("p",{className:"font-semibold text-red-900",children:[s.failed," שורה(ות) נכשלו"]})})]}),s.failedRows.length>0&&e.jsx("div",{className:"max-h-48 overflow-y-auto space-y-2",children:s.failedRows.map(a=>e.jsxs("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:[e.jsxs("p",{className:"font-medium text-red-900",children:["שורה ",a.row]}),e.jsx("ul",{className:"list-disc list-inside text-sm text-red-800 mt-1",children:a.errors.map((n,d)=>e.jsx("li",{children:n},d))})]},a.row))})]})]}),e.jsx("div",{className:"pt-4 border-t",children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:["הייבוא הושלם. ",s.imported+s.failed," שורות עובדו."]})})]})}const de={step:"upload",isLoading:!1,error:null,selectedFile:null,previewData:null,rowsToImport:[],importResults:null};function He(s,a){switch(a.type){case"SELECT_FILE":return{...s,selectedFile:a.payload,error:null};case"SET_ERROR":return{...s,error:a.payload};case"START_AXION":return{...s,isLoading:!0,error:null};case"PREVIEW_SUCCESS":return{...s,isLoading:!1,previewData:a.payload.previewData,rowsToImport:a.payload.rowsToImport,step:"preview"};case"IMPORT_SUCCESS":return{...s,isLoading:!1,importResults:a.payload,step:"results"};case"AXION_ERROR":return{...s,isLoading:!1,error:a.payload};case"RESET":return de;case"SET_STEP":return{...s,step:a.payload};case"UPDATE_ROWS":return{...s,rowsToImport:a.payload};default:return s}}function Qe({open:s,onOpenChange:a,onImportComplete:n}){const[d,t]=c.useReducer(He,de),{step:l,isLoading:i,error:r,selectedFile:u,previewData:p,rowsToImport:h,importResults:f}=d,v=x=>{const j=x.target.files?.[0];if(j){const N=j.name.split(".").pop()?.toLowerCase();if(!["csv","xlsx","xls"].includes(N||"")){t({type:"SET_ERROR",payload:"רק קבצי CSV ו-Excel (.xlsx, .xls) מותרים"});return}if(j.size>50*1024*1024){t({type:"SET_ERROR",payload:"גודל הקובץ חורג מ-50MB"});return}t({type:"SELECT_FILE",payload:j})}},E=async()=>{if(u){t({type:"START_AXION"});try{const x=await Q.previewImport(u);t({type:"PREVIEW_SUCCESS",payload:{previewData:x,rowsToImport:x.validRows}})}catch(x){t({type:"AXION_ERROR",payload:x.message||"שגיאה בטעינת הקובץ"})}}},w=async()=>{if(h.length===0){t({type:"SET_ERROR",payload:"אין שורות לייבוא"});return}t({type:"START_AXION"});try{const x=await Q.confirmImport({rowsToImport:h});t({type:"IMPORT_SUCCESS",payload:x}),n?.()}catch(x){t({type:"AXION_ERROR",payload:x.message||"שגיאה בייבוא הנתונים"})}},g=()=>{t({type:"RESET"}),a(!1)};return e.jsx(Le,{open:s,onOpenChange:g,children:e.jsxs(le,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",dir:"rtl",children:[e.jsx(re,{children:e.jsx(ie,{children:"ייבוא בוגרים מקובץ"})}),r&&e.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg flex gap-3",children:[e.jsx(W,{className:"h-5 w-5 text-red-600 shrink-0 mt-0.5"}),e.jsx("p",{className:"text-red-800",children:r})]}),l==="upload"&&e.jsx(Ue,{onFileSelect:v,selectedFile:u}),l==="preview"&&p&&e.jsx(Xe,{previewData:p,rowsToImport:h,setRowsToImport:x=>t({type:"UPDATE_ROWS",payload:x})}),l==="results"&&f&&e.jsx(Be,{importResults:f}),e.jsxs(ne,{children:[l==="upload"&&e.jsxs(e.Fragment,{children:[e.jsx(m,{variant:"outline",onClick:()=>a(!1),children:"ביטול"}),e.jsx(m,{onClick:E,disabled:!u||i,children:i?"טוען...":"תצוגה מקדימה"})]}),l==="preview"&&e.jsxs(e.Fragment,{children:[e.jsx(m,{variant:"outline",onClick:()=>t({type:"SET_STEP",payload:"upload"}),disabled:i,children:"חזור"}),e.jsx(m,{variant:"outline",onClick:()=>t({type:"SET_STEP",payload:"upload"}),disabled:i,children:"בחר קובץ אחר"}),e.jsx(m,{onClick:w,disabled:h.length===0||i,children:i?"מייבא...":"אישור ייבוא"})]}),l==="results"&&e.jsxs(e.Fragment,{children:[e.jsx(m,{variant:"outline",onClick:g,children:"סגור"}),e.jsx(m,{onClick:g,children:"חזור לדף בוגרים"})]})]})]})})}function We({canCreate:s,canImport:a,onAdd:n,onImport:d}){return e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold tracking-tight",children:"ניהול בוגרים"}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[s&&e.jsxs(m,{onClick:n,className:"flex-1 sm:flex-none",children:[e.jsx(pe,{className:"h-4 w-4"}),"רישום בוגר חדש"]}),a&&e.jsxs(m,{variant:"outline",onClick:d,className:"flex-1 sm:flex-none",children:[e.jsx(ge,{className:"h-4 w-4"}),"ייבוא מקובץ"]})]})]})}const Ye=c.memo(function({graduate:a,onEdit:n,onView:d,onDelete:t,canEdit:l,canDelete:i}){const r=c.useRef(0),u=()=>{const h=Date.now();h-r.current<300&&d(a),r.current=h},p=(h,f)=>{f.offset.x<-200&&l&&n(a),f.offset.x>200&&i&&t&&t(a)};return e.jsxs("div",{className:"relative overflow-x-hidden",children:[l&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-start rounded-lg bg-orange-100 pl-4 z-0 left-1/2 dark:bg-yellow-950",children:e.jsxs("div",{className:"flex flex-col items-center gap-1 text-orange-600 font-bold px-2 text-sm dark:text-yellow-400",children:[e.jsx(z,{size:16}),e.jsx("span",{children:"עריכה"})]})}),i&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-end rounded-lg bg-red-100 pr-4 z-0 right-1/2 dark:bg-red-950",children:e.jsxs("div",{className:"flex flex-col items-center gap-1 text-red-600 font-bold px-2 text-sm dark:text-red-400",children:[e.jsx($,{size:16}),e.jsx("span",{children:"מחיקה"})]})}),e.jsx(fe.div,{drag:"x",dragConstraints:{left:0,right:0},dragElastic:{left:l?.2:0,right:i?.2:0},onDragEnd:p,onTap:u,className:"touch-pan-y relative z-10 bg-card rounded-lg",whileTap:{scale:.98},style:{x:0},children:e.jsxs(Ge,{className:"px-4 py-2 flex-row justify-between items-center select-none shadow-sm border",children:[e.jsxs("div",{className:"flex flex-col gap-1 pointer-events-none flex-1 min-w-0 overflow-hidden",children:[e.jsxs("div",{className:"font-bold text-base truncate",children:[a.first_name," ",a.last_name]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-muted-foreground w-full",children:[a.shiur_year&&e.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[e.jsx(je,{size:12}),e.jsx("span",{children:a.shiur_year})]}),a.phone&&e.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[e.jsx(ye,{size:12}),e.jsx("span",{dir:"ltr",children:a.phone})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsx(ae,{graduate:a}),e.jsxs(ke,{children:[e.jsx(Re,{asChild:!0,children:e.jsx(m,{variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(Ne,{className:"h-4 w-4"})})}),e.jsxs(Ee,{align:"end",className:"w-auto flex flex-row gap-2 p-2",children:[e.jsxs(D,{onClick:()=>d(a),className:"flex flex-col items-center justify-center gap-1 rounded-md bg-secondary/10 p-2 aspect-square focus:bg-secondary/20",children:[e.jsx(Y,{className:"h-6 w-6 text-primary"}),e.jsx("span",{className:"text-xs font-medium",children:"צפייה"})]}),l&&e.jsxs(D,{onClick:()=>n(a),className:"flex flex-col items-center justify-center gap-1 rounded-md bg-orange-50 dark:bg-orange-900/20 p-2 aspect-square focus:bg-orange-100 dark:focus:bg-orange-900/40",children:[e.jsx(z,{className:"h-6 w-6 text-orange-600 dark:text-orange-400"}),e.jsx("span",{className:"text-xs font-medium text-orange-700 dark:text-orange-300",children:"עריכה"})]}),i&&t&&e.jsxs(D,{className:"flex flex-col items-center justify-center gap-1 rounded-md bg-red-50 dark:bg-red-900/20 p-2 aspect-square focus:bg-red-100 dark:focus:bg-red-900/40 text-destructive focus:text-destructive dark:text-red-400 dark:focus:text-red-300",onClick:()=>t(a),children:[e.jsx($,{className:"h-6 w-6"}),e.jsx("span",{className:"text-xs font-medium",children:"מחיקה"})]})]})]})]})]})})]})});function Je({onView:s,onEdit:a,onDelete:n,can:d,availableYears:t,availableCities:l,fieldCounts:i}){return[{accessorKey:"fullName",header:"שם מלא",accessorFn:r=>`${r.first_name} ${r.last_name}`,cell:({row:r})=>e.jsxs("div",{className:"font-medium",children:[r.original.first_name," ",r.original.last_name]}),meta:{filterVariant:"text"}},{accessorKey:"phone",header:"פלאפון",meta:{filterVariant:"presence",filterOptions:[{label:`ריקים בלבד${i.phone?` (${i.phone.empty})`:""}`,value:"isEmpty"},{label:`מלאים בלבד${i.phone?` (${i.phone.notEmpty})`:""}`,value:"isNotEmpty"}]}},{accessorKey:"city",header:"עיר",cell:({row:r})=>r.original.city||"",meta:{filterVariant:"select",filterOptions:[{label:`[ריק]${i.city?` (${i.city.empty})`:""}`,value:"isEmpty"},...l.map(r=>({label:`${r.city} (${r.count})`,value:r.city}))]}},{accessorKey:"shiur_year",header:"מחזור",cell:({row:r})=>r.original.shiur_year||"",meta:{filterVariant:"select",filterOptions:[{label:`[ריק]${i.shiur_year?` (${i.shiur_year.empty})`:""}`,value:"empty"},...t.map(r=>({label:`${r.shiur_year} (${r.count})`,value:r.shiur_year}))]}},{id:"status",header:"סטטוס",cell:({row:r})=>e.jsx(ae,{graduate:r.original})},{id:"actions",header:"פעולות",cell:({row:r})=>{const u=r.original,p=d("update","graduates",u),h=d("delete","graduates");return e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsxs(F,{children:[e.jsx(O,{asChild:!0,children:e.jsx(m,{variant:"ghost",size:"icon",onClick:()=>s(u),children:e.jsx(Y,{className:"h-4 w-4"})})}),e.jsx(P,{children:e.jsx("p",{children:"צפייה"})})]}),p&&e.jsxs(F,{children:[e.jsx(O,{asChild:!0,children:e.jsx(m,{variant:"ghost",size:"icon",onClick:()=>a(u),children:e.jsx(z,{className:"h-4 w-4"})})}),e.jsx(P,{children:e.jsx("p",{children:"עריכה"})})]}),h&&e.jsxs(F,{children:[e.jsx(O,{asChild:!0,children:e.jsx(m,{variant:"ghost",size:"icon",className:"text-destructive hover:text-destructive",onClick:()=>n(u),children:e.jsx($,{className:"h-4 w-4"})})}),e.jsx(P,{children:e.jsx("p",{children:"מחיקה"})})]})]})}}]}function xs(){const{can:s,user:a,isShiurManager:n}=Se(),d=Ae();Ie("ניהול בוגרים");const t=Te(),[l,i]=c.useState({pageIndex:0,pageSize:20,sorting:[],globalFilter:"",filters:[]}),[r,u]=c.useState(0),p=(l.filters??[]).filter(o=>o.id!=="shiur_year"),h=(l.filters??[]).filter(o=>o.id!=="city"),{data:f}=C({queryKey:["graduate-years",p,l.globalFilter,r],queryFn:()=>b.getGraduateYears({filters:p,globalFilter:l.globalFilter}),placeholderData:o=>o}),v=f??[],{data:E}=C({queryKey:["graduate-cities",h,l.globalFilter,r],queryFn:()=>b.getGraduateCities({filters:h,globalFilter:l.globalFilter}),placeholderData:o=>o}),w=E??[],[g,x]=c.useState(null),[j,N]=c.useState(!1),[oe,M]=c.useState(!1),{data:ce}=C({queryKey:["graduate-field-counts",l.filters,l.globalFilter,r],queryFn:()=>b.getGraduateFieldCounts({filters:l.filters,globalFilter:l.globalFilter}),placeholderData:o=>o}),G=ce??{},{data:S,isLoading:L,isFetching:V,isError:q}=C({queryKey:["graduates",l,r,n?a?.shiurs:void 0],queryFn:()=>b.getGraduates(l),placeholderData:o=>o}),K=S?.data??[],U=S?.total??0,X=(S?.pages??Math.ceil(U/(l.pageSize||20)))||1,T=c.useCallback(o=>{d(`/graduates/${o.id}/edit`)},[d]),xe=c.useCallback(()=>{d("/graduates/new")},[d]),I=c.useCallback(o=>{d(`/graduates/${o.id}`)},[d]),_=c.useCallback(o=>{x(o),N(!0)},[]),me=c.useCallback(async()=>{g&&(await b.deleteGraduate(g.id),N(!1),x(null),u(o=>o+1),t.invalidateQueries({queryKey:["graduates"]}))},[g,t]),B=c.useMemo(()=>Je({onView:I,onEdit:T,onDelete:_,can:s,availableYears:v,availableCities:w,fieldCounts:G}),[I,T,_,s,v,w,G]);return s("read","graduates")?e.jsxs("div",{className:"space-y-6",children:[e.jsx(We,{canCreate:s("create","graduates"),canImport:s("import","graduates"),onAdd:xe,onImport:()=>M(!0)}),e.jsxs("div",{className:"bg-card rounded-lg border shadow-sm p-4 text-card-foreground flex flex-col",children:[e.jsx(_e,{columns:B,state:l,onStateChange:i}),e.jsxs("div",{className:"overflow-x-auto rounded-md border",children:[e.jsx(De,{columns:B,data:K,pageCount:X,isLoading:L,isFetching:V,isError:q,state:l,onStateChange:i}),e.jsx(Fe,{data:K,isLoading:L,isFetching:V,isError:q,renderCard:o=>e.jsx(Ye,{graduate:o,onEdit:T,onView:I,onDelete:s("delete","graduates")?_:void 0,canEdit:s("update","graduates",o),canDelete:s("delete","graduates")},o.id)})]}),e.jsx("div",{className:"mt-4 border-t pt-2",children:e.jsx(Oe,{state:l,onStateChange:i,totalItems:U,pageCount:X})})]}),e.jsx(Pe,{open:j,onOpenChange:o=>{N(o),o||x(null)},title:"מחיקת בוגר",description:e.jsxs(e.Fragment,{children:["האם אתה בטוח שברצונך למחוק את הבוגר"," ",e.jsxs("strong",{children:[g?.first_name," ",g?.last_name]}),"? פעולה זו אינה הפיכה."]}),onConfirm:me,variant:"destructive",confirmText:"מחק"}),e.jsx(Qe,{open:oe,onOpenChange:M,onImportComplete:()=>{u(o=>o+1),t.invalidateQueries({queryKey:["graduates"]})}})]}):e.jsx(Me,{to:"/unauthorized"})}export{xs as default};
