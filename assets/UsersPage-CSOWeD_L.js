import{j as e,r as w,s as v,v as V,w as _,x as $,y as F,z as T,i as S,h as H,A as G}from"./ui-cYaPCmFq.js";import{r as t,u as J}from"./vendor-CxWUHsYF.js";import{D as M,b as q,B as i,d as L,e as n,a as Q,f as W}from"./index-B82nMEN1.js";import{u as U}from"./usersService-C7_hOxu_.js";import{T as z,a as x,b as h,c as m}from"./tooltip-DPo-ytnn.js";import{I as X}from"./input-CeRAAvL1.js";import{D as Y,C as Z}from"./ConfirmDialog-BNIvhHXn.js";import{C as ee,a as se}from"./card-Dk-l4baR.js";import"./index-CGUgPmau.js";function ae({user:a,onEdit:l,onView:j,onDelete:c,canEdit:d,canDelete:o,onChangePassword:g}){const u=t.useRef(0),p=()=>{const r=Date.now();r-u.current<300&&j(a),u.current=r},f=(r,N)=>{N.offset.x<-100&&d&&l(a),N.offset.x>100&&o&&c&&c(a)};return e.jsxs("div",{className:"relative",children:[d&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-start rounded-lg bg-orange-100 pl-4 z-0 left-1/2 dark:bg-yellow-950",children:e.jsxs("div",{className:"flex flex-col items-center gap-1 text-orange-600 font-bold px-2 text-sm dark:text-yellow-400",children:[e.jsx(w,{size:16}),e.jsx("span",{children:"עריכה"})]})}),o&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-end rounded-lg bg-red-100 pr-4 z-0 right-1/2 dark:bg-red-950",children:e.jsxs("div",{className:"flex flex-col items-center gap-1 text-red-600 font-bold px-2 text-sm dark:text-red-400",children:[e.jsx(v,{size:16}),e.jsx("span",{children:"מחיקה"})]})}),e.jsx(V.div,{drag:"x",dragConstraints:{left:0,right:0},dragElastic:{left:d?.2:0,right:o?.2:0},onDragEnd:f,onTap:p,className:"touch-pan-y relative z-10 bg-card rounded-lg",style:{x:0},children:e.jsx(ee,{className:"p-0 border-0 shadow-none",children:e.jsx(se,{className:"p-4 py-3",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-bold text-lg flex items-center gap-2",children:[a.firstName," ",a.lastName,!a.passwordChanged&&e.jsx(z,{children:e.jsxs(x,{children:[e.jsx(h,{children:e.jsx("div",{className:"h-2 w-2 rounded-full bg-red-500 animate-pulse"})}),e.jsx(m,{children:e.jsx("p",{children:"למשתמש זה לא הוגדרה סיסמה"})})]})})]}),e.jsx("div",{className:"text-sm text-muted-foreground mt-1 flex items-center gap-1",children:a.role==="shiur_manager"&&e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-semibold",children:"מחזורים: "}),a.shiurs?.length?a.shiurs.join(", "):"-"]})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium gap-1 whitespace-nowrap ${a.role==="super_admin"?"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-300":"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300"}`,children:a.role==="super_admin"?e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"h-3 w-3"})," מנהל"]}):e.jsxs(e.Fragment,{children:[e.jsx($,{className:"h-3 w-3"})," אחראי"]})}),e.jsx("div",{onPointerDown:r=>r.stopPropagation(),onClick:r=>r.stopPropagation(),children:e.jsxs(M,{children:[e.jsx(q,{asChild:!0,children:e.jsx(i,{variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(F,{className:"h-4 w-4"})})}),e.jsxs(L,{align:"end",className:"w-auto flex flex-row gap-2 p-2",children:[e.jsxs(n,{onClick:()=>j(a),className:"flex flex-col items-center justify-center gap-1 rounded-md bg-secondary/10 p-2 aspect-square focus:bg-secondary/20",children:[e.jsx(T,{className:"h-6 w-6 text-primary"}),e.jsx("span",{className:"text-xs font-medium",children:"צפייה"})]}),g&&e.jsxs(n,{onClick:()=>g(a),className:"relative flex flex-col items-center justify-center gap-1 rounded-md bg-blue-50 dark:bg-blue-900/20 p-2  aspect-square focus:bg-blue-100 dark:focus:bg-blue-900/40",children:[!a.passwordChanged&&e.jsx("span",{className:"absolute top-1 right-1 h-2 w-2 rounded-full bg-red-500 animate-pulse"}),e.jsx(S,{className:"h-6 w-6 text-blue-600 dark:text-blue-400"}),e.jsx("span",{className:"text-xs font-medium text-blue-700 dark:text-blue-300",children:"סיסמה"})]}),d&&e.jsxs(n,{onClick:()=>l(a),className:"flex flex-col items-center justify-center gap-1 rounded-md bg-orange-50 dark:bg-orange-900/20 p-2  aspect-square focus:bg-orange-100 dark:focus:bg-orange-900/40",children:[e.jsx(w,{className:"h-6 w-6 text-orange-600 dark:text-orange-400"}),e.jsx("span",{className:"text-xs font-medium text-orange-700 dark:text-orange-300",children:"עריכה"})]}),o&&c&&e.jsxs(n,{className:"flex flex-col items-center justify-center gap-1 rounded-md bg-red-50 dark:bg-red-900/20 p-2 aspect-square focus:bg-red-100 dark:focus:bg-red-900/40 text-destructive focus:text-destructive dark:text-red-400 dark:focus:text-red-300",onClick:()=>c(a),children:[e.jsx(v,{className:"h-6 w-6"}),e.jsx("span",{className:"text-xs font-medium",children:"מחיקה"})]})]})]})})]})]})})})})]})}function he(){const{isSuperAdmin:a}=Q(),l=J(),[j,c]=t.useState([]),[d,o]=t.useState(0),[g,u]=t.useState(!1),[p,f]=t.useState(1),[r,N]=t.useState(""),[I,O]=t.useState(""),[b,P]=t.useState(null),[R,C]=t.useState(!1);t.useEffect(()=>{a||l("/unauthorized")},[a,l]),t.useEffect(()=>{const s=setTimeout(()=>{O(r),f(1)},500);return()=>clearTimeout(s)},[r]);const E=async()=>{u(!0);try{const s=await U.getUsers({page:p,pageSize:10,search:I});c(s.data),o(s.total)}finally{u(!1)}};t.useEffect(()=>{a&&E()},[p,I,a]);const k=s=>{l(`/users/${s.id}/edit`)},y=s=>{l(`/users/${s.id}`)},D=s=>{P(s),C(!0)},A=async()=>{b&&(await U.deleteUser(b.id),C(!1),P(null),E())};if(!a)return null;const B=[{header:"שם מלא",cell:s=>e.jsxs("div",{className:"font-medium flex items-center gap-2",children:[s.firstName," ",s.lastName,!s.passwordChanged&&e.jsx(z,{children:e.jsxs(x,{children:[e.jsx(h,{children:e.jsx("div",{className:"h-2 w-2 rounded-full bg-red-500 animate-pulse"})}),e.jsx(m,{children:e.jsx("p",{children:"למשתמש זה לא הוגדרה סיסמה"})})]})})]})},{header:"אימייל",accessorKey:"email"},{header:"תפקיד",cell:s=>e.jsx("span",{className:`inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium ${s.role==="super_admin"?"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-300":"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300"}`,children:s.role==="super_admin"?e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"ml-1 h-3 w-3"})," מנהל ראשי"]}):e.jsxs(e.Fragment,{children:[e.jsx($,{className:"ml-1 h-3 w-3"})," אחראי שיעור"]})})},{header:"מחזורים",cell:s=>s.role==="shiur_manager"&&s.shiurs?.length?s.shiurs.join(", "):"-"},{header:"פעולות",cell:s=>e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden md:flex justify-end gap-2",children:e.jsxs(z,{children:[e.jsxs(x,{children:[e.jsx(h,{asChild:!0,children:e.jsx(i,{variant:"ghost",size:"icon",onClick:()=>y(s),children:e.jsx(T,{className:"h-4 w-4"})})}),e.jsx(m,{children:e.jsx("p",{children:"צפייה"})})]}),e.jsxs(x,{children:[e.jsx(h,{asChild:!0,children:e.jsx(i,{variant:"ghost",size:"icon",onClick:()=>l(`/users/${s.id}/password`),className:s.passwordChanged?"text-destructive hover:text-destructive":"text-accent hover:text-accent",children:e.jsx(S,{className:"h-4 w-4"})})}),e.jsx(m,{children:e.jsxs("p",{children:[s.passwordChanged?"שינוי":"הגדרת"," סיסמה"]})})]}),e.jsxs(x,{children:[e.jsx(h,{asChild:!0,children:e.jsx(i,{variant:"ghost",size:"icon",onClick:()=>k(s),children:e.jsx(w,{className:"h-4 w-4"})})}),e.jsx(m,{children:e.jsx("p",{children:"עריכה"})})]}),e.jsxs(x,{children:[e.jsx(h,{asChild:!0,children:e.jsx(i,{variant:"ghost",size:"icon",className:"text-destructive hover:text-destructive",onClick:()=>D(s),children:e.jsx(v,{className:"h-4 w-4"})})}),e.jsx(m,{children:e.jsx("p",{children:"מחיקה"})})]})]})}),e.jsx("div",{className:"flex md:hidden justify-end",children:e.jsxs(M,{children:[e.jsx(q,{asChild:!0,children:e.jsx(i,{variant:"ghost",size:"icon",children:e.jsx(F,{className:"h-4 w-4"})})}),e.jsxs(L,{align:"end",className:"w-auto",children:[e.jsx(W,{children:"פעולות"}),e.jsxs(n,{onClick:()=>y(s),children:[e.jsx(T,{className:"mr-2 h-4 w-4"})," צפייה"]}),e.jsxs(n,{onClick:()=>l(`/users/${s.id}/password`),className:s.passwordChanged?"text-destructive focus:text-destructive":"text-accent focus:text-accent",children:[e.jsx(S,{className:"mr-2 h-4 w-4"})," ",s.passwordChanged?"שינוי":"הגדרת"," סיסמה"]}),e.jsxs(n,{onClick:()=>k(s),children:[e.jsx(w,{className:"mr-2 h-4 w-4"})," עריכה"]}),e.jsxs(n,{onClick:()=>D(s),className:"text-destructive focus:text-destructive",children:[e.jsx(v,{className:"mr-2 h-4 w-4"})," מחיקה"]})]})]})})]})}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold tracking-tight",children:"ניהול משתמשים"}),e.jsxs(i,{onClick:()=>{l("/users/new")},className:"w-full sm:w-auto",children:[e.jsx(H,{className:"mr-2 h-4 w-4"}),"הוספת משתמש"]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("div",{className:"relative flex-1 w-full sm:max-w-sm",children:[e.jsx(G,{className:"absolute right-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(X,{placeholder:"חיפוש לפי שם או אימייל...",className:"pr-9 w-full",value:r,onChange:s=>N(s.target.value)})]})}),e.jsx(Y,{data:j,columns:B,total:d,page:p,pageSize:10,onPageChange:f,isLoading:g,mobileRenderer:s=>e.jsx(ae,{user:s,onEdit:k,onView:y,onDelete:D,onChangePassword:K=>l(`/users/${K.id}/password`),canEdit:!0,canDelete:!0})}),e.jsx(Z,{open:R,onOpenChange:C,title:"מחיקת משתמש",description:e.jsxs(e.Fragment,{children:["האם אתה בטוח שברצונך למחוק את המשתמש"," ",e.jsxs("strong",{children:[b?.firstName," ",b?.lastName]}),"? פעולה זו אינה הפיכה."]}),onConfirm:A,variant:"destructive",confirmText:"מחק"})]})}export{he as default};
