import{j as e,r as p,s as g,v as W,e as X,B as Z,C as ee,y as K,z as P,h as se,A as ae,E as te}from"./ui-BdsuqOTa.js";import{r as t,u as re}from"./vendor-CxWUHsYF.js";import{D as R,b as q,B as c,d as B,e as o,a as ne,f as le}from"./index-D_mPSwq-.js";import{g as G}from"./graduatesService-Col7aa1F.js";import{I as F}from"./input-FDbJpi5c.js";import{D as ie,C as ce}from"./ConfirmDialog-Cq7LzDMo.js";import{C as oe}from"./card-J7dVxng9.js";import{P as L}from"./ProfileCompletion-JuFokNhf.js";import{T as de,a as T,b as z,c as I}from"./tooltip-H8Iafm6f.js";import"./index-C2MNuPaw.js";function xe({graduate:a,onEdit:h,onView:d,onDelete:r,canEdit:n,canDelete:l}){const m=t.useRef(0),v=()=>{const i=Date.now();i-m.current<300&&d(a),m.current=i},N=(i,u)=>{u.offset.x<-200&&n&&h(a),u.offset.x>200&&l&&r&&r(a)};return e.jsxs("div",{className:"relative",children:[n&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-start rounded-lg bg-orange-100 pl-4 z-0 left-1/2 dark:bg-yellow-950",children:e.jsxs("div",{className:"flex flex-col items-center gap-1 text-orange-600 font-bold px-2 text-sm dark:text-yellow-400",children:[e.jsx(p,{size:16}),e.jsx("span",{children:"עריכה"})]})}),l&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-end rounded-lg bg-red-100 pr-4 z-0 right-1/2 dark:bg-red-950",children:e.jsxs("div",{className:"flex flex-col items-center gap-1 text-red-600 font-bold px-2 text-sm dark:text-red-400",children:[e.jsx(g,{size:16}),e.jsx("span",{children:"מחיקה"})]})}),e.jsx(W.div,{drag:"x",dragConstraints:{left:0,right:0},dragElastic:{left:n?.2:0,right:l?.2:0},onDragEnd:N,onTap:v,className:"touch-pan-y relative z-10 bg-card rounded-lg",whileTap:{scale:.98},style:{x:0},children:e.jsxs(oe,{className:"px-4 py-2 flex-row justify-between items-center select-none border-0 shadow-none",children:[e.jsxs("div",{className:"flex flex-col gap-1 pointer-events-none w-full overflow-hidden",children:[e.jsxs("div",{className:"font-bold text-base truncate",children:[a.first_name," ",a.last_name]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-muted-foreground w-full",children:[a.shiur_year&&e.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[e.jsx(X,{size:12}),e.jsx("span",{children:a.shiur_year})]}),a.city&&e.jsxs("div",{className:"flex items-center gap-1 shrink-0 truncate max-w-[80px]",children:[e.jsx(Z,{size:12}),e.jsx("span",{className:"truncate",children:a.city})]}),a.phone&&e.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[e.jsx(ee,{size:12}),e.jsx("span",{dir:"ltr",children:a.phone})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{graduate:a}),e.jsxs(R,{children:[e.jsx(q,{asChild:!0,children:e.jsx(c,{variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(K,{className:"h-4 w-4"})})}),e.jsxs(B,{align:"end",className:"w-auto flex flex-row gap-2 p-2",children:[e.jsxs(o,{onClick:()=>d(a),className:"flex flex-col items-center justify-center gap-1 rounded-md bg-secondary/10 p-2 aspect-square focus:bg-secondary/20",children:[e.jsx(P,{className:"h-6 w-6 text-primary"}),e.jsx("span",{className:"text-xs font-medium",children:"צפייה"})]}),n&&e.jsxs(o,{onClick:()=>h(a),className:"flex flex-col items-center justify-center gap-1 rounded-md bg-orange-50 dark:bg-orange-900/20 p-2 aspect-square focus:bg-orange-100 dark:focus:bg-orange-900/40",children:[e.jsx(p,{className:"h-6 w-6 text-orange-600 dark:text-orange-400"}),e.jsx("span",{className:"text-xs font-medium text-orange-700 dark:text-orange-300",children:"עריכה"})]}),l&&r&&e.jsxs(o,{className:"flex flex-col items-center justify-center gap-1 rounded-md bg-red-50 dark:bg-red-900/20 p-2 aspect-square focus:bg-red-100 dark:focus:bg-red-900/40 text-destructive focus:text-destructive dark:text-red-400 dark:focus:text-red-300",onClick:()=>r(a),children:[e.jsx(g,{className:"h-6 w-6"}),e.jsx("span",{className:"text-xs font-medium",children:"מחיקה"})]})]})]})]})]})})]})}function ye(){const{can:a,user:h,isShiurManager:d}=ne(),r=re(),[n,l]=t.useState([]),[m,v]=t.useState(0),[N,i]=t.useState(!1),[u,O]=t.useState(0),[w,_]=t.useState(1),[y,Y]=t.useState(""),[E,A]=t.useState(""),[f,V]=t.useState(""),[j,M]=t.useState(null),[$,b]=t.useState(!1);t.useEffect(()=>{},[]),t.useEffect(()=>{const s=setTimeout(()=>{A(y),_(1)},500);return()=>clearTimeout(s)},[y]),t.useEffect(()=>{let s=!1;return(async()=>{i(!0);try{const x=await G.getGraduates({page:w,pageSize:20,search:E,shiurYear:f||void 0,myShiurs:d?h?.shiurs:void 0});s||(l(x.data),v(x.total))}finally{s||i(!1)}})(),()=>{s=!0}},[w,E,f,d,u]);const C=s=>{r(`/graduates/${s.id}/edit`)},H=()=>{r("/graduates/new")},k=s=>{r(`/graduates/${s.id}`)},D=s=>{M(s),b(!0)},J=async()=>{j&&(await G.deleteGraduate(j.id),b(!1),M(null),O(s=>s+1))},Q=a("create","graduates"),U=[{header:"שם מלא",cell:s=>e.jsxs("div",{className:"font-medium",children:[s.first_name," ",s.last_name]})},{header:"פלאפון",accessorKey:"phone"},{header:"עיר",accessorKey:"city"},{header:"מחזור",accessorKey:"shiur_year",cell:s=>s.shiur_year||"ללא מחזור"},{header:"סטטוס",cell:s=>e.jsx(L,{graduate:s})},{header:"פעולות",cell:s=>{const S=a("update","graduates",s),x=a("delete","graduates");return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden md:flex justify-end gap-2",children:e.jsxs(de,{children:[e.jsxs(T,{children:[e.jsx(z,{asChild:!0,children:e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>k(s),children:e.jsx(P,{className:"h-4 w-4"})})}),e.jsx(I,{children:e.jsx("p",{children:"צפייה"})})]}),S&&e.jsxs(T,{children:[e.jsx(z,{asChild:!0,children:e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>C(s),children:e.jsx(p,{className:"h-4 w-4"})})}),e.jsx(I,{children:e.jsx("p",{children:"עריכה"})})]}),x&&e.jsxs(T,{children:[e.jsx(z,{asChild:!0,children:e.jsx(c,{variant:"ghost",size:"icon",className:"text-destructive hover:text-destructive",onClick:()=>D(s),children:e.jsx(g,{className:"h-4 w-4"})})}),e.jsx(I,{children:e.jsx("p",{children:"מחיקה"})})]})]})}),e.jsx("div",{className:"flex md:hidden justify-end",children:e.jsxs(R,{children:[e.jsx(q,{asChild:!0,children:e.jsx(c,{variant:"ghost",size:"icon",children:e.jsx(K,{className:"h-4 w-4"})})}),e.jsxs(B,{align:"end",children:[e.jsx(le,{children:"פעולות"}),e.jsxs(o,{onClick:()=>k(s),children:[e.jsx(P,{className:"mr-2 h-4 w-4"})," צפייה"]}),S&&e.jsxs(o,{onClick:()=>C(s),children:[e.jsx(p,{className:"mr-2 h-4 w-4"})," עריכה"]}),x&&e.jsxs(o,{onClick:()=>D(s),className:"text-destructive focus:text-destructive",children:[e.jsx(g,{className:"mr-2 h-4 w-4"})," מחיקה"]})]})]})})]})}}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold tracking-tight",children:"ניהול בוגרים"}),Q&&e.jsxs(c,{onClick:H,className:"w-full sm:w-auto",children:[e.jsx(se,{className:"h-4 w-4"}),"רישום בוגר חדש"]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ae,{className:"absolute right-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(F,{placeholder:"חיפוש לפי שם...",className:"pr-9",value:y,onChange:s=>Y(s.target.value)})]}),e.jsx("div",{className:"w-full sm:w-48",children:e.jsxs("div",{className:"relative",children:[e.jsx(te,{className:"absolute right-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(F,{type:"text",placeholder:"סינון לפי מחזור (לדוגמה: נח)",className:"pr-9",value:f,onChange:s=>V(s.target.value)})]})})]}),e.jsx(ie,{data:n,columns:U,total:m,page:w,pageSize:20,onPageChange:_,isLoading:N,mobileRenderer:s=>e.jsx(xe,{graduate:s,onEdit:C,onView:k,onDelete:a("delete","graduates")?D:void 0,canEdit:a("update","graduates",s),canDelete:a("delete","graduates")})}),e.jsx(ce,{open:$,onOpenChange:b,title:"מחיקת בוגר",description:e.jsxs(e.Fragment,{children:["האם אתה בטוח שברצונך למחוק את הבוגר"," ",e.jsxs("strong",{children:[j?.first_name," ",j?.last_name]}),"? פעולה זו אינה הפיכה."]}),onConfirm:J,variant:"destructive",confirmText:"מחק"})]})}export{ye as default};
